event=abs(ts_zscore(ts_delay(close,1)-open,20))>2;
alpha=ts_delta(close,5)/ts_stddev(close,252);
close_at_event = trade_when(event,close,-1);
end=abs(close_at_event-close)/close_at_event>0.1;

bar=(open-close)/(high-low);
a=ts_sum((open>close)*bar,20)/ts_sum((open<close)*(-bar),20);
b=ts_sum((open>close)*bar,252)/ts_sum((open<close)*(-bar),252);


ts_kurtosis(close,20)>ts_kurtosis(close,90)?ts_decay_linear(trade_when(event,alpha,end),5):rank(a/b)
